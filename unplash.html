<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Unsplash Search UI</title>
  <style>
    :root {
      --bg: #0f1724;
      --card: #0b1220;
      --muted: #9aa4b2;
      --accent: #06b6d4;
      --gap: 12px;
    }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg, #071226 0%, #081428 100%);
      color: #e6eef6;
      padding: 28px;
      box-sizing: border-box;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
    }
    header {
      display:flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    h1 {
      margin: 0;
      font-size: 20px;
      letter-spacing: -0.2px;
    }
    .controls {
      display:flex;
      gap: 8px;
      align-items:center;
      margin-left: auto;
      flex-wrap: wrap;
    }
    input[type="text"], select {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.06);
      background: rgba(255,255,255,0.02);
      color: inherit;
      min-width: 160px;
      outline: none;
    }
    button {
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      background: var(--accent);
      color: #042027;
      font-weight: 600;
      cursor: pointer;
    }
    button.secondary {
      background: transparent;
      color: var(--muted);
      border: 1px solid rgba(255,255,255,0.04);
    }
    .meta {
      color: var(--muted);
      margin-top: 8px;
      font-size: 13px;
    }
    .grid {
      display:grid;
      gap: var(--gap);
      grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
      margin-top: 18px;
    }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(2,6,23,0.6);
      display:flex;
      flex-direction: column;
      min-height: 200px;
    }
    .card img {
      width:100%;
      height:160px;
      object-fit: cover;
      display:block;
    }
    .card .info {
      padding: 10px;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      align-items:center;
    }
    .photographer {
      font-size: 13px;
      color: var(--muted);
      text-decoration: none;
    }
    .photographer:hover { text-decoration: underline; }
    .footer {
      display:flex;
      justify-content: space-between;
      align-items:center;
      margin-top: 18px;
      gap: 12px;
      flex-wrap: wrap;
    }
    .pagination {
      display:flex;
      gap: 8px;
      align-items:center;
    }
    .status {
      color: var(--muted);
      font-size: 13px;
    }
    .spinner {
      display:inline-block;
      width:14px;
      height:14px;
      border:2px solid rgba(255,255,255,0.12);
      border-top-color: var(--accent);
      border-radius:50%;
      animation: spin 0.9s linear infinite;
      vertical-align: middle;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* small screens */
    @media (max-width:520px) {
      header { gap: 10px; }
      .controls { justify-content: flex-end; width:100% }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Unsplash Search</h1>
        <div class="meta">Search Unsplash through your server: <code>/unsplash?query=&lt;q&gt;&amp;per_page=&lt;n&gt;&amp;page=&lt;p&gt;</code></div>
      </div>

      <div class="controls" role="search" aria-label="Search controls">
        <input id="q" type="text" placeholder="Search (e.g., nature, sunset)" value="nature" />
        <select id="per_page" title="Results per page">
          <option value="6">6 per page</option>
          <option value="9" selected>9 per page</option>
          <option value="12">12 per page</option>
          <option value="18">18 per page</option>
        </select>
        <input id="page" type="number" min="1" value="1" style="width:72px" />
        <button id="searchBtn">Search</button>
        <button id="randomBtn" class="secondary" title="Get random photos">Random</button>
      </div>
    </header>

    <div id="status" class="status"></div>

    <main>
      <div id="results" class="grid" aria-live="polite"></div>
    </main>

    <div class="footer">
      <div class="pagination">
        <button id="prev" class="secondary">◀ Prev</button>
        <div id="pageInfo" class="status">Page 1</div>
        <button id="next" class="secondary">Next ▶</button>
      </div>

      <div class="meta">Powered by your server endpoint <code>/unsplash</code>. Do not expose your Unsplash secret key in client code.</div>
    </div>
  </div>

  <script>
    // ---- Configuration ----
    const API_BASE = '/unsplash'; // calls your server endpoint
    // -----------------------

    const qInput = document.getElementById('q');
    const perPageInput = document.getElementById('per_page');
    const pageInput = document.getElementById('page');
    const resultsEl = document.getElementById('results');
    const statusEl = document.getElementById('status');
    const pageInfo = document.getElementById('pageInfo');

    const searchBtn = document.getElementById('searchBtn');
    const randomBtn = document.getElementById('randomBtn');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');

    let lastQuery = '';
    let lastTotal = 0;

    function setStatus(text, isLoading = false) {
      statusEl.innerHTML = isLoading ? '<span class="spinner" aria-hidden="true"></span> ' + text : text;
    }

    function renderResults(results) {
      resultsEl.innerHTML = '';
      if (!results || results.length === 0) {
        resultsEl.innerHTML = '<div class="meta">No results found.</div>';
        return;
      }

      for (const r of results) {
        const el = document.createElement('article');
        el.className = 'card';

        const img = document.createElement('img');
        // prefer small or regular urls; unsplash returns urls: small, thumb, regular, full
        img.src = r.urls.small || r.urls.regular || r.urls.thumb;
        img.alt = r.alt_description || r.description || 'Unsplash photo';
        img.loading = 'lazy';

        const info = document.createElement('div');
        info.className = 'info';

        const left = document.createElement('div');
        left.style.flex = '1';
        const pName = document.createElement('a');
        pName.className = 'photographer';
        pName.href = (r.user && r.user.links && r.user.links.html) ? r.user.links.html : '#';
        pName.target = '_blank';
        pName.rel = 'noopener noreferrer';
        pName.textContent = r.user ? (r.user.name || r.user.username) : 'Unknown';

        const likes = document.createElement('div');
        likes.className = 'meta';
        likes.style.fontSize = '12px';
        likes.textContent = (typeof r.likes === 'number') ? `${r.likes} ♥` : '';

        left.appendChild(pName);

        const right = document.createElement('div');
        right.style.textAlign = 'right';
        const view = document.createElement('a');
        view.className = 'photographer';
        view.href = r.links && r.links.html ? r.links.html : '#';
        view.target = '_blank';
        view.rel = 'noopener noreferrer';
        view.textContent = 'View';

        right.appendChild(likes);
        right.appendChild(view);

        info.appendChild(left);
        info.appendChild(right);

        el.appendChild(img);
        el.appendChild(info);

        resultsEl.appendChild(el);
      }
    }

    async function fetchSearch({ query = 'nature', per_page = 9, page = 1 } = {}) {
      try {
        setStatus('Loading...', true);
        const qs = new URLSearchParams({ query, per_page, page });
        const resp = await fetch(API_BASE + '?' + qs.toString(), { credentials: 'same-origin' });

        if (!resp.ok) {
          // try to show helpful error info
          const text = await resp.text().catch(() => '');
          setStatus(`Error: ${resp.status} — ${text || resp.statusText}`);
          if (resp.status === 401) setStatus('Unauthorized (401). Make sure your server is using the correct Unsplash Access Key.', false);
          resultsEl.innerHTML = '';
          return;
        }

        const data = await resp.json();
        if (!data || data.success === false) {
          setStatus('Error: ' + (data && data.error ? data.error : 'Unknown error'));
          resultsEl.innerHTML = '';
          return;
        }

        lastQuery = query;
        lastTotal = data.total || 0;
        pageInfo.textContent = `Page ${page} — ${lastTotal} results`;

        renderResults(data.results || []);
        setStatus(`Loaded ${data.results?.length || 0} results`);
      } catch (err) {
        setStatus('Fetch error: ' + (err.message || err));
        resultsEl.innerHTML = '';
      }
    }

    // Event handlers
    searchBtn.addEventListener('click', () => {
      const q = qInput.value.trim() || 'nature';
      const per = perPageInput.value || 9;
      const pg = Math.max(1, Number(pageInput.value) || 1);
      pageInput.value = pg;
      fetchSearch({ query: q, per_page: per, page: pg });
    });

    randomBtn.addEventListener('click', async () => {
      // call server endpoint with a few random queries or use the search endpoint with "random" query
      // Here we simply call /unsplash?query=random to let server respond (server uses Unsplash search).
      const pg = 1;
      pageInput.value = pg;
      fetchSearch({ query: 'random', per_page: perPageInput.value || 9, page: pg });
    });

    prevBtn.addEventListener('click', () => {
      const pg = Math.max(1, Number(pageInput.value) - 1);
      pageInput.value = pg;
      searchBtn.click();
    });

    nextBtn.addEventListener('click', () => {
      const pg = Math.max(1, Number(pageInput.value) + 1);
      pageInput.value = pg;
      searchBtn.click();
    });

    // run initial search on load
    window.addEventListener('load', () => {
      searchBtn.click();
    });
  </script>
</body>
</html>
