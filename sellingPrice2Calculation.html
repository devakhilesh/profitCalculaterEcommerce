<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Selling Price Calculator - Professional Edition</title>
  <style>
    /* CSS Variables for consistent theming */
    :root {
      /* Colors */
      --primary-color: #3b82f6;
      --primary-dark: #2563eb;
      --secondary-color: #f97316;
      --secondary-dark: #ea580c;
      --success-color: #10b981;
      --danger-color: #ef4444;
      --light-bg: #f8fafc;
      --card-bg: #ffffff;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #64748b;
      --border-color: #e2e8f0;
      --border-light: #f1f5f9;
      
      /* Typography */
      --font-family: 'Inter', 'Segoe UI', 'Roboto', 'Arial', sans-serif;
      --font-size-xs: 0.75rem;
      --font-size-sm: 0.875rem;
      --font-size-base: 1rem;
      --font-size-lg: 1.125rem;
      --font-size-xl: 1.25rem;
      --font-size-2xl: 1.5rem;
      
      /* Spacing */
      --spacing-xs: 0.25rem;
      --spacing-sm: 0.5rem;
      --spacing-md: 1rem;
      --spacing-lg: 1.5rem;
      --spacing-xl: 2rem;
      --spacing-2xl: 3rem;
      
      /* Border Radius */
      --border-radius-sm: 0.375rem;
      --border-radius: 0.5rem;
      --border-radius-lg: 0.75rem;
      --border-radius-xl: 1rem;
      
      /* Shadows */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    /* Base Styles */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: var(--font-family);
      background-color: var(--light-bg);
      color: var(--text-primary);
      line-height: 1.5;
      padding: var(--spacing-lg);
    }
    
    /* Typography */
    .calculator__title {
      font-size: var(--font-size-2xl);
      font-weight: 700;
      margin-bottom: var(--spacing-sm);
      color: var(--text-primary);
    }
    
    .calculator__subtitle {
      font-size: var(--font-size-sm);
      color: var(--text-secondary);
      margin-bottom: var(--spacing-lg);
    }
    
    .section__title {
      font-size: var(--font-size-lg);
      font-weight: 600;
      margin-bottom: var(--spacing-md);
      color: var(--text-primary);
    }
    
    .card__title {
      font-size: var(--font-size-sm);
      font-weight: 600;
      margin-bottom: var(--spacing-md);
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    .label {
      display: block;
      font-size: var(--font-size-sm);
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-xs);
    }
    
    .value {
      font-size: var(--font-size-base);
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .value--highlight {
      color: var(--primary-color);
      font-size: var(--font-size-lg);
    }
    
    /* Layout Components */
    .calculator {
      max-width: 1200px;
      margin: 0 auto;
      background-color: var(--card-bg);
      border-radius: var(--border-radius-xl);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
    }
    
    .calculator__header {
      padding: var(--spacing-xl);
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
    }
    
    .calculator__header .calculator__title,
    .calculator__header .calculator__subtitle {
      color: white;
    }
    
    .calculator__header .calculator__subtitle {
      opacity: 0.9;
    }
    
    .calculator__body {
      padding: var(--spacing-xl);
    }
    
    .grid {
      display: grid;
      gap: var(--spacing-lg);
    }
    
    .grid--2cols {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .grid--3cols {
      grid-template-columns: repeat(3, 1fr);
    }
    
    .grid--4cols {
      grid-template-columns: repeat(4, 1fr);
    }
    
    /* Form Elements */
    .form-group {
      margin-bottom: var(--spacing-md);
    }
    
    .input {
      width: 100%;
      padding: var(--spacing-sm) var(--spacing-md);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      font-size: var(--font-size-base);
      transition: all 0.2s ease;
      background-color: white;
    }
    
    .input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .input--with-icon {
      padding-left: 2.5rem;
    }
    
    .input-icon {
      position: absolute;
      left: var(--spacing-md);
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
    }
    
    .input-wrapper {
      position: relative;
    }
    
    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: var(--spacing-sm) var(--spacing-lg);
      border: none;
      border-radius: var(--border-radius);
      font-size: var(--font-size-sm);
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      gap: var(--spacing-xs);
    }
    
    .btn--primary {
      background-color: var(--primary-color);
      color: white;
    }
    
    .btn--primary:hover {
      background-color: var(--primary-dark);
    }
    
    .btn--secondary {
      background-color: var(--secondary-color);
      color: white;
    }
    
    .btn--secondary:hover {
      background-color: var(--secondary-dark);
    }
    
    .btn--outline {
      background-color: transparent;
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
    }
    
    .btn--outline:hover {
      background-color: var(--light-bg);
    }
    
    .btn-group {
      display: flex;
      gap: var(--spacing-sm);
    }
    
    /* Cards */
    .card {
      background-color: var(--card-bg);
      border-radius: var(--border-radius-lg);
      padding: var(--spacing-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-light);
    }
    
    .card--highlight {
      border-left: 4px solid var(--primary-color);
    }
    
    .card--result {
      background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
    }
    
    /* Results Section */
    .results {
      margin-top: var(--spacing-2xl);
    }
    
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }
    
    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--spacing-sm) 0;
      border-bottom: 1px solid var(--border-light);
    }
    
    .result-item:last-child {
      border-bottom: none;
    }
    
    .result-item--total {
      border-top: 2px solid var(--border-color);
      font-weight: 600;
      margin-top: var(--spacing-sm);
      padding-top: var(--spacing-md);
    }
    
    /* JSON Output */
    .json-output {
      background-color: #0f172a;
      color: #e2e8f0;
      padding: var(--spacing-lg);
      border-radius: var(--border-radius);
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: var(--font-size-sm);
      overflow-x: auto;
      margin-top: var(--spacing-lg);
    }
    
    /* Footer */
    .footer {
      margin-top: var(--spacing-xl);
      padding-top: var(--spacing-lg);
      border-top: 1px solid var(--border-color);
      font-size: var(--font-size-sm);
      color: var(--text-muted);
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
      .grid--4cols {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: var(--spacing-md);
      }
      
      .calculator__body {
        padding: var(--spacing-lg);
      }
      
      .grid--2cols,
      .grid--3cols,
      .grid--4cols {
        grid-template-columns: 1fr;
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
    }
    
    /* Utility Classes */
    .text-center {
      text-align: center;
    }
    
    .text-right {
      text-align: right;
    }
    
    .mb-sm {
      margin-bottom: var(--spacing-sm);
    }
    
    .mb-md {
      margin-bottom: var(--spacing-md);
    }
    
    .mb-lg {
      margin-bottom: var(--spacing-lg);
    }
    
    .mt-sm {
      margin-top: var(--spacing-sm);
    }
    
    .mt-md {
      margin-top: var(--spacing-md);
    }
    
    .mt-lg {
      margin-top: var(--spacing-lg);
    }
    
    .full-width {
      grid-column: 1 / -1;
    }
    
    .hidden {
      display: none;
    }
    
    /* Animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-out;
    }
  </style>
</head>
<body>
  <div class="calculator">
    <header class="calculator__header">
      <h1 class="calculator__title">Selling Price Calculator</h1>
      <p class="calculator__subtitle">Calculate your optimal selling price with detailed expense breakdown</p>
    </header>
    
    <div class="calculator__body">
      <form id="calcForm" class="grid grid--2cols">
        <!-- Input Section -->
        <section class="form-section">
          <h2 class="section__title">Input Parameters</h2>
          
          <div class="grid grid--2cols">
            <div class="form-group">
              <label for="dispatch" class="label">Total Orders (Dispatch)</label>
              <div class="input-wrapper">
                <span class="input-icon">ðŸ“¦</span>
                <input id="dispatch" type="number" min="0" step="1" value="100" class="input input--with-icon" required />
              </div>
            </div>
            
            <div class="form-group">
              <label for="costPrice" class="label">Cost Price (with GST)</label>
              <div class="input-wrapper">
                <span class="input-icon">â‚¹</span>
                <input id="costPrice" type="number" min="0" step="0.01" value="150" class="input input--with-icon" required />
              </div>
            </div>
            
            <div class="form-group">
              <label for="RTO_percent" class="label">RTO % (Return to Origin)</label>
              <input id="RTO_percent" type="number" min="0" step="0.01" value="15" class="input" />
            </div>
            
            <div class="form-group">
              <label for="DTO_percent" class="label">DTO % (Damage/Transit Problems)</label>
              <input id="DTO_percent" type="number" min="0" step="0.01" value="15" class="input" />
            </div>
            
            <div class="form-group">
              <label for="meesho_return_charge" class="label">Meesho Return Charge (per return)</label>
              <div class="input-wrapper">
                <span class="input-icon">â‚¹</span>
                <input id="meesho_return_charge" type="number" min="0" step="0.01" value="175" class="input input--with-icon" />
              </div>
            </div>
            
            <div class="form-group">
              <label for="ads_withGst" class="label">Total Ads (with GST)</label>
              <div class="input-wrapper">
                <span class="input-icon">â‚¹</span>
                <input id="ads_withGst" type="number" min="0" step="0.01" value="590" class="input input--with-icon" />
              </div>
            </div>
            
            <div class="form-group">
              <label for="wrong_damage_percent" class="label">Wrong/Damaged %</label>
              <input id="wrong_damage_percent" type="number" min="0" step="0.01" value="5" class="input" />
            </div>
            
            <div class="form-group">
              <label for="perOrderPckExpense" class="label">Packaging Expense (per order)</label>
              <div class="input-wrapper">
                <span class="input-icon">â‚¹</span>
                <input id="perOrderPckExpense" type="number" min="0" step="0.01" value="5" class="input input--with-icon" />
              </div>
            </div>
            
            <div class="form-group">
              <label for="shipping_Gst_per_order" class="label">Shipping GST (per order)</label>
              <div class="input-wrapper">
                <span class="input-icon">â‚¹</span>
                <input id="shipping_Gst_per_order" type="number" min="0" step="0.01" value="13" class="input input--with-icon" />
              </div>
            </div>
            
            <div class="form-group">
              <label for="profit" class="label">Desired Profit (per dispatched order)</label>
              <div class="input-wrapper">
                <span class="input-icon">â‚¹</span>
                <input id="profit" type="number" min="0" step="0.01" value="20" class="input input--with-icon" />
              </div>
            </div>
          </div>
        </section>
        
        <!-- Actions & Summary -->
        <section class="actions-section">
          <div class="card card--highlight">
            <h2 class="section__title">Quick Actions</h2>
            
            <div class="btn-group mb-md">
              <button type="button" id="calculateBtn" class="btn btn--primary">Calculate</button>
              <button type="reset" class="btn btn--outline">Reset</button>
            </div>
            
            <div class="btn-group">
              <button type="button" id="copyJson" class="btn btn--outline">Copy JSON</button>
              <button type="button" id="downloadJson" class="btn btn--secondary">Download JSON</button>
            </div>
          </div>
          
          <div class="card mt-lg">
            <h2 class="section__title">Calculation Summary</h2>
            <div id="summaryContent">
              <p class="text-center text-muted">Click "Calculate" to see results</p>
            </div>
          </div>
        </section>
      </form>
      
      <!-- Results Section -->
      <section class="results hidden" id="resultsSection">
        <h2 class="section__title">Detailed Breakdown</h2>
        
        <div class="results-grid" id="resultsArea">
          <!-- Results will be populated by JavaScript -->
        </div>
        
        <!-- Final Price Card -->
        <div class="card card--result mt-lg">
          <div class="result-item result-item--total">
            <span class="label">Final Selling Price</span>
            <span id="finalPrice" class="value value--highlight">â‚¹0.00</span>
          </div>
        </div>
      </section>
      
      <!-- JSON Output -->
      <section class="mt-xl">
        <h2 class="section__title">Raw Calculation Data</h2>
        <pre id="jsonOutput" class="json-output">{}</pre>
      </section>
      
      <footer class="footer">
        <p><strong>Note:</strong> All amounts shown are per paid order unless labeled. If "Orders to be paid" equals zero, some per-order values will be shown as 0 to avoid division errors.</p>
      </footer>
    </div>
  </div>

  <script>
    // Utility: safe toFixed -> Number
    function formatNumber(v) { 
      return Number(Number(v || 0).toFixed(2)); 
    }

    // Main calculation function
    function calculate(data) {
      // Return Expense Calculation
      const returnExpense = {};
      const totalDispatch = Number(data.dispatch || 0);
      const rtoPercentage = Number(data.RTO_percent || 0);
      const dtoPercentage = Number(data.DTO_percent || 0);
      const meeshoReturnCharge = Number(data.meesho_return_charge || 0);

      returnExpense.totalDispatch = totalDispatch;
      returnExpense.rtoPercentage = rtoPercentage;
      returnExpense.rtoOrders = formatNumber((totalDispatch * rtoPercentage) / 100);

      // Total delivered orders after RTO
      const totalDelivered = formatNumber(totalDispatch - returnExpense.rtoOrders);
      returnExpense.totalDelivered = totalDelivered;

      returnExpense.dtoPercentage = dtoPercentage;
      returnExpense.dtoOrders = formatNumber((totalDelivered * dtoPercentage) / 100);

      // Orders that will actually be paid (dispatched - rto - dto)
      const ordersToBePaid = formatNumber(totalDispatch - returnExpense.rtoOrders - returnExpense.dtoOrders);
      returnExpense.ordersToBePaid = ordersToBePaid;

      returnExpense.meeshoReturnCharge = meeshoReturnCharge;
      returnExpense.totalReturnAmount = formatNumber(returnExpense.dtoOrders * meeshoReturnCharge);

      const returnExpensePerOrder = ordersToBePaid > 0 ? 
        formatNumber(returnExpense.totalReturnAmount / ordersToBePaid) : 0;
      returnExpense.returnExpensePerOrder = returnExpensePerOrder;

      // Advertisement Expense
      const advertisementExpense = {};
      advertisementExpense.ordersToBePaid = ordersToBePaid;
      advertisementExpense.totalAds = Number(data.ads_withGst || 0);
      const adsExpensePerOrder = ordersToBePaid > 0 ? 
        formatNumber(advertisementExpense.totalAds / ordersToBePaid) : 0;
      advertisementExpense.adsExpensePerOrder = adsExpensePerOrder;

      // Wrong/Damaged Items
      const wrongDamage = {};
      wrongDamage.totalDispatch = totalDispatch;
      wrongDamage.wrongDamagePercentage = Number(data.wrong_damage_percent || 0);
      wrongDamage.wrongDamageCount = formatNumber((totalDispatch * wrongDamage.wrongDamagePercentage) / 100);

      const costPrice = Number(data.costPrice || 0);
      const wrongDamagePerOrder = ordersToBePaid > 0 ? 
        formatNumber((wrongDamage.wrongDamageCount * costPrice) / ordersToBePaid) : 0;
      wrongDamage.wrongDamagePerOrder = wrongDamagePerOrder;

      // Packaging Expense
      const packagingExpense = {};
      packagingExpense.perOrderExpense = Number(data.perOrderPckExpense || 0);
      const totalPackagingExpense = formatNumber(totalDispatch * packagingExpense.perOrderExpense);
      packagingExpense.totalExpense = totalPackagingExpense;
      const packagingPerPaidOrder = ordersToBePaid > 0 ? 
        formatNumber(totalPackagingExpense / ordersToBePaid) : 0;
      packagingExpense.packagingPerPaidOrder = packagingPerPaidOrder;

      // Final Calculation
      const finalCalculation = {};
      finalCalculation.purchasePrice = costPrice;
      finalCalculation.packagingExpense = packagingPerPaidOrder;
      finalCalculation.returnCharge = returnExpensePerOrder;
      finalCalculation.adsExpense = adsExpensePerOrder;
      finalCalculation.shippingGst = Number(data.shipping_Gst_per_order || 0);
      finalCalculation.wrongDamage = wrongDamagePerOrder;

      const totalCost = formatNumber(
        costPrice +
        packagingPerPaidOrder +
        returnExpensePerOrder +
        adsExpensePerOrder +
        finalCalculation.shippingGst +
        wrongDamagePerOrder
      );
      finalCalculation.totalCost = totalCost;

      finalCalculation.desiredProfit = Number(data.profit || 0);

      const profitPerPaidOrder = ordersToBePaid > 0 ? 
        formatNumber((totalDispatch * Number(data.profit || 0)) / ordersToBePaid) : 0;
      finalCalculation.profitPerPaidOrder = profitPerPaidOrder;

      finalCalculation.finalSellingPrice = formatNumber(totalCost + profitPerPaidOrder);

      // Consolidated output
      return {
        inputs: data,
        returnExpense,
        advertisementExpense,
        wrongDamage,
        packagingExpense,
        finalCalculation
      };
    }

    // UI: Render summary
    function renderSummary(out) {
      const summaryContent = document.getElementById('summaryContent');
      
      if (out.finalCalculation.ordersToBePaid === 0) {
        summaryContent.innerHTML = `
          <div class="text-center">
            <p><strong>No paid orders</strong> - check your RTO and DTO percentages</p>
          </div>
        `;
        return;
      }
      
      summaryContent.innerHTML = `
        <div class="result-item">
          <span class="label">Orders to be paid:</span>
          <span class="value">${out.returnExpense.ordersToBePaid}</span>
        </div>
        <div class="result-item">
          <span class="label">Total cost per order:</span>
          <span class="value">â‚¹${out.finalCalculation.totalCost.toFixed(2)}</span>
        </div>
        <div class="result-item">
          <span class="label">Profit per paid order:</span>
          <span class="value">â‚¹${out.finalCalculation.profitPerPaidOrder.toFixed(2)}</span>
        </div>
        <div class="result-item result-item--total">
          <span class="label">Final selling price:</span>
          <span class="value value--highlight">â‚¹${out.finalCalculation.finalSellingPrice.toFixed(2)}</span>
        </div>
      `;
    }

    // UI: Render detailed results
    function renderDetailedResults(out) {
      const area = document.getElementById('resultsArea');
      area.innerHTML = '';
      
      // Helper to create result cards
      function createCard(title, items) {
        const card = document.createElement('div');
        card.className = 'card fade-in';
        
        const titleEl = document.createElement('h3');
        titleEl.className = 'card__title';
        titleEl.textContent = title;
        card.appendChild(titleEl);
        
        items.forEach(item => {
          const itemEl = document.createElement('div');
          itemEl.className = `result-item ${item.isTotal ? 'result-item--total' : ''}`;
          
          const label = document.createElement('span');
          label.className = 'label';
          label.textContent = item.label;
          
          const value = document.createElement('span');
          value.className = 'value';
          value.textContent = typeof item.value === 'number' ? 
            (item.isCurrency ? `â‚¹${item.value.toFixed(2)}` : item.value.toFixed(2)) : 
            item.value;
          
          itemEl.appendChild(label);
          itemEl.appendChild(value);
          card.appendChild(itemEl);
        });
        
        return card;
      }
      
      // Return Expense Card
      area.appendChild(createCard('Return Expense', [
        { label: 'Total Dispatched Orders', value: out.returnExpense.totalDispatch },
        { label: 'RTO Percentage', value: out.returnExpense.rtoPercentage },
        { label: 'Orders Lost to RTO', value: out.returnExpense.rtoOrders },
        { label: 'Delivered After RTO', value: out.returnExpense.totalDelivered },
        { label: 'DTO Percentage', value: out.returnExpense.dtoPercentage },
        { label: 'Orders Lost to DTO', value: out.returnExpense.dtoOrders },
        { label: 'Orders to be Paid', value: out.returnExpense.ordersToBePaid },
        { label: 'Total Return Amount', value: out.returnExpense.totalReturnAmount, isCurrency: true },
        { label: 'Return Expense per Paid Order', value: out.returnExpense.returnExpensePerOrder, isCurrency: true }
      ]));
      
      // Advertisement Card
      area.appendChild(createCard('Advertisement', [
        { label: 'Total Ads (with GST)', value: out.advertisementExpense.totalAds, isCurrency: true },
        { label: 'Ads per Paid Order', value: out.advertisementExpense.adsExpensePerOrder, isCurrency: true }
      ]));
      
      // Wrong/Damaged Items Card
      area.appendChild(createCard('Wrong/Damaged Items', [
        { label: 'Wrong/Damage Percentage', value: out.wrongDamage.wrongDamagePercentage },
        { label: 'Count of Wrong Items', value: out.wrongDamage.wrongDamageCount },
        { label: 'Per Paid Order Wrong Damage Amount', value: out.wrongDamage.wrongDamagePerOrder, isCurrency: true }
      ]));
      
      // Packaging Card
      area.appendChild(createCard('Packaging', [
        { label: 'Packaging per Dispatched Order', value: out.packagingExpense.perOrderExpense, isCurrency: true },
        { label: 'Total Packaging Expense', value: out.packagingExpense.totalExpense, isCurrency: true },
        { label: 'Packaging per Paid Order', value: out.packagingExpense.packagingPerPaidOrder, isCurrency: true }
      ]));
      
      // Final Calculation Card
      area.appendChild(createCard('Final Calculation', [
        { label: 'Purchase with GST (per unit)', value: out.finalCalculation.purchasePrice, isCurrency: true },
        { label: 'Packaging Expense', value: out.finalCalculation.packagingExpense, isCurrency: true },
        { label: 'Return Charge', value: out.finalCalculation.returnCharge, isCurrency: true },
        { label: 'Ads Expense', value: out.finalCalculation.adsExpense, isCurrency: true },
        { label: 'Shipping GST', value: out.finalCalculation.shippingGst, isCurrency: true },
        { label: 'Wrong/Damage Cost', value: out.finalCalculation.wrongDamage, isCurrency: true },
        { label: 'Total Cost per Paid Order', value: out.finalCalculation.totalCost, isCurrency: true, isTotal: true },
        { label: 'Desired Profit (per dispatched order)', value: out.finalCalculation.desiredProfit, isCurrency: true },
        { label: 'Distributed Profit per Paid Order', value: out.finalCalculation.profitPerPaidOrder, isCurrency: true },
        { label: 'Final Selling Price', value: out.finalCalculation.finalSellingPrice, isCurrency: true, isTotal: true }
      ]));
      
      // Update final price display
      document.getElementById('finalPrice').textContent = 
        `â‚¹${out.finalCalculation.finalSellingPrice.toFixed(2)}`;
    }

    // Event handlers
    document.getElementById('calculateBtn').addEventListener('click', () => {
      const data = {
        dispatch: Number(document.getElementById('dispatch').value || 0),
        RTO_percent: Number(document.getElementById('RTO_percent').value || 0),
        DTO_percent: Number(document.getElementById('DTO_percent').value || 0),
        meesho_return_charge: Number(document.getElementById('meesho_return_charge').value || 0),
        ads_withGst: Number(document.getElementById('ads_withGst').value || 0),
        wrong_damage_percent: Number(document.getElementById('wrong_damage_percent').value || 0),
        perOrderPckExpense: Number(document.getElementById('perOrderPckExpense').value || 0),
        shipping_Gst_per_order: Number(document.getElementById('shipping_Gst_per_order').value || 0),
        costPrice: Number(document.getElementById('costPrice').value || 0),
        profit: Number(document.getElementById('profit').value || 0)
      };

      const results = calculate(data);
      
      // Show results section
      document.getElementById('resultsSection').classList.remove('hidden');
      
      // Render results
      renderSummary(results);
      renderDetailedResults(results);
      
      // Update JSON output
      document.getElementById('jsonOutput').textContent = JSON.stringify(results, null, 2);
      
      // Store for copy/download
      window.lastCalculation = results;
    });

    document.getElementById('copyJson').addEventListener('click', () => {
      if (!window.lastCalculation) {
        alert('Please calculate first');
        return;
      }
      
      navigator.clipboard.writeText(JSON.stringify(window.lastCalculation, null, 2))
        .then(() => alert('JSON copied to clipboard'))
        .catch(() => alert('Copy failed'));
    });

    document.getElementById('downloadJson').addEventListener('click', () => {
      if (!window.lastCalculation) {
        alert('Please calculate first');
        return;
      }
      
      const blob = new Blob([JSON.stringify(window.lastCalculation, null, 2)], 
        { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'selling_price_calculation.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // Auto-calculate on first load
    document.getElementById('calculateBtn').click();
  </script>
</body>
</html>