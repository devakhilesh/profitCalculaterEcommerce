// GET API with HTML interface
app.get("/genImage", (req, res) => {
  const html = `
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Seedream 4.0 Image Generator</title>
      <style>
          * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
          }
          
          body {
              font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              min-height: 100vh;
              padding: 20px;
          }
          
          .container {
              max-width: 800px;
              margin: 0 auto;
              background: white;
              border-radius: 15px;
              box-shadow: 0 20px 40px rgba(0,0,0,0.1);
              overflow: hidden;
          }
          
          .header {
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              padding: 30px;
              text-align: center;
          }
          
          .header h1 {
              font-size: 2.5rem;
              margin-bottom: 10px;
          }
          
          .header p {
              opacity: 0.9;
              font-size: 1.1rem;
          }
          
          .form-container {
              padding: 40px;
          }
          
          .form-group {
              margin-bottom: 25px;
          }
          
          label {
              display: block;
              margin-bottom: 8px;
              font-weight: 600;
              color: #333;
              font-size: 1.1rem;
          }
          
          textarea {
              width: 100%;
              height: 120px;
              padding: 15px;
              border: 2px solid #e1e5e9;
              border-radius: 10px;
              font-size: 16px;
              font-family: inherit;
              resize: vertical;
              transition: border-color 0.3s ease;
          }
          
          textarea:focus {
              outline: none;
              border-color: #667eea;
          }
          
          select {
              width: 100%;
              padding: 12px 15px;
              border: 2px solid #e1e5e9;
              border-radius: 10px;
              font-size: 16px;
              background: white;
              cursor: pointer;
          }
          
          .generate-btn {
              width: 100%;
              padding: 16px;
              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
              color: white;
              border: none;
              border-radius: 10px;
              font-size: 1.2rem;
              font-weight: 600;
              cursor: pointer;
              transition: transform 0.2s ease;
          }
          
          .generate-btn:hover {
              transform: translateY(-2px);
          }
          
          .generate-btn:disabled {
              opacity: 0.6;
              cursor: not-allowed;
              transform: none;
          }
          
          .result-container {
              margin-top: 30px;
              padding: 20px;
              border-radius: 10px;
              background: #f8f9fa;
              display: none;
          }
          
          .loading {
              text-align: center;
              padding: 20px;
              display: none;
          }
          
          .spinner {
              border: 4px solid #f3f3f3;
              border-top: 4px solid #667eea;
              border-radius: 50%;
              width: 40px;
              height: 40px;
              animation: spin 1s linear infinite;
              margin: 0 auto 15px;
          }
          
          @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
          }
          
          .image-result {
              text-align: center;
          }
          
          .generated-image {
              max-width: 100%;
              border-radius: 10px;
              box-shadow: 0 10px 25px rgba(0,0,0,0.1);
          }
          
          .error {
              background: #fee;
              color: #c33;
              padding: 15px;
              border-radius: 8px;
              margin-top: 20px;
              display: none;
          }
      </style>
  </head>
  <body>
      <div class="container">
          <div class="header">
              <h1>ðŸŽ¨ Seedream 4.0</h1>
              <p>AI Image Generation Platform</p>
          </div>
          
          <div class="form-container">
              <div class="form-group">
                  <label for="prompt">Describe your image:</label>
                  <textarea 
                      id="prompt" 
                      placeholder="Enter a detailed description of the image you want to generate..."
                  >Interstellar travel, a black hole, from which a nearly shattered vintage train bursts forth, visually striking, cinematic blockbuster, apocalyptic vibe...</textarea>
              </div>
              
              <div class="form-group">
                  <label for="size">Image Size:</label>
                  <select id="size">
                      <option value="1K">1K Resolution</option>
                      <option value="2K" selected>2K Resolution</option>
                  </select>
              </div>
              
              <button class="generate-btn" onclick="generateImage()">
                  Generate Image
              </button>
              
              <div class="loading" id="loading">
                  <div class="spinner"></div>
                  <p>Generating your image... This may take a few seconds.</p>
              </div>
              
              <div class="result-container" id="resultContainer">
                  <div class="image-result">
                      <h3>Generated Image:</h3>
                      <img id="generatedImage" class="generated-image" alt="Generated Image">
                      <div style="margin-top: 15px;">
                          <a id="downloadLink" href="#" download="generated-image.jpg">
                              <button style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                  Download Image
                              </button>
                          </a>
                      </div>
                  </div>
              </div>
              
              <div class="error" id="errorContainer"></div>
          </div>
      </div>

      <script>
          async function generateImage() {
              const prompt = document.getElementById('prompt').value;
              const size = document.getElementById('size').value;
              const generateBtn = document.querySelector('.generate-btn');
              const loading = document.getElementById('loading');
              const resultContainer = document.getElementById('resultContainer');
              const errorContainer = document.getElementById('errorContainer');
              
              if (!prompt.trim()) {
                  showError('Please enter a prompt description');
                  return;
              }
              
              // Reset UI
              generateBtn.disabled = true;
              generateBtn.textContent = 'Generating...';
              loading.style.display = 'block';
              resultContainer.style.display = 'none';
              errorContainer.style.display = 'none';
              
              try {
                  const response = await fetch('/imageGenerationByPrompt', {
                      method: 'POST',
                      headers: {
                          'Content-Type': 'application/json',
                      },
                      body: JSON.stringify({ prompt, size })
                  });
                  
                  const data = await response.json();
                  
                  if (data.success) {
                      document.getElementById('generatedImage').src = data.imageUrl;
                      document.getElementById('downloadLink').href = data.imageUrl;
                      resultContainer.style.display = 'block';
                  } else {
                      showError(data.error || 'Failed to generate image');
                  }
                  
              } catch (error) {
                  showError('Network error: ' + error.message);
              } finally {
                  generateBtn.disabled = false;
                  generateBtn.textContent = 'Generate Image';
                  loading.style.display = 'none';
              }
          }
          
          function showError(message) {
              const errorContainer = document.getElementById('errorContainer');
              errorContainer.textContent = message;
              errorContainer.style.display = 'block';
          }
          
          // Allow Enter key to trigger generation (with Ctrl/Cmd)
          document.getElementById('prompt').addEventListener('keydown', function(e) {
              if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                  generateImage();
              }
          });
      </script>
  </body>
  </html>
  `;
  
  res.send(html);
});

// Start server
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
  console.log(`Access the image generator at: http://localhost:${PORT}/genImage`);
});